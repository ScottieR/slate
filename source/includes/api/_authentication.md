# Authentication

## Logging in a user and authenticating your client

> To authorize, use this code:

```shell
curl --data "email=[email]&password=[password]" https://travelenvy.com/api/sessions
```

```ruby
#In your ruby console:
require 'oauth2'

client_id     = '...' # your client's id
client_secret = '...' # your client's secret
redirect_uri  = '...' # your client's redirect uri
site          = "http://localhost:3000" # your provider server, this is showing localhost

client = OAuth2::Client.new(client_id, client_secret, :site => site)

client.auth_code.authorize_url(:redirect_uri => redirect_uri)
# => http://localhost:3000/oauth/authorize?response_type=code&client_id=...&redirect_uri=...

#visit the url generated by the above code while signed in to a TravelEnvy account, then get the access_code returned in the url and use as [ACCESS_CODE] in the following call
access = client.auth_code.get_token([ACCESS_CODE], redirect_uri: redirect_uri)

#OR pass a valid username & password to the oauth client retrieve the access token
access = client.password.get_token('user@example.com', 'sekret')

#Get token to append to HTTP requests by calling
puts access.token
```

> This is the json response to the above code

```json
{
	"access_token": "...", 
	"token_type": "persistant"
}
```

This is the endpoint to retrieve a user's access token when they have provided their credentials, or to use as a callback to authenticate using Facebook oauth

### HTTP Request
`POST https://travelenvy.com/api/sessions`

Parameter | Required | Description
--------- | -------- | -----------
email | true | user's provided email address
password | true | user's provided password

<aside class="notice">
Either the email and password parameters must be submitted, or this endpoint must be used as a callback for Facebook's omniauth flow
</aside>

<aside class="notice">
You must email us at hello@travelenvy.com to register your API, in order to be granted a client_id and client_secret.
</aside>

### Response

Attribute | Description
--------- | -----------
access_token | token to append to all following requests
token_type | the type of token provided, default is persistant, it does not expire until a user explicitly resets it by logging out.

## Get current resource owner (aka current user)

> To access the current_user use this code:

```shell
	curl https://travelenvy.com/api/me?access_token=your_token
```

```ruby
access.get("/api/me").parsed
```

> The json response is the same as "Getting a Specific User", please see that section below.

This is the endpoint to retrieve the currently logged in user.

### HTTP Request

`GET https://travelenvy.com/api/me`

### Query Parameters

None.

### Response

The response is the same as "Getting a Specific User", please see that section below.

